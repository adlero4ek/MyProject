entities:

  BusinessObjects:
    title: Бизнес объекты
    description: "Бизнес объекты - это представления реальных объектов деятельности. Они могут отображать
      - как физические объекты: помещения, активы, контракты
      - так и абстрактные понятия: сорта яблок, обращения клиентов."
    presentations:
      blank:
        title: Основная карточка бизнес объекта
        type: markdown
        template: templates/business_object_card.md
        source: >
          (
          
            $MANIFEST := $;  
  
            $query := $.ApplicationDataObjects.$spread().(
  
                $app_data_obj_id := $keys()[0];
  
                *.business_Objects.(
  
                    $array_busness_obj := $;
                    $busness_obj := $lookup($MANIFEST.BusinessObjects, $array_busness_obj);
                    $busness_obj := $merge([$busness_obj, {"id": $array_busness_obj}]);
  
                    {
                      "AppDataObject_id": $app_data_obj_id,              
                      "BusinessObject_id": $busness_obj.id
                    }       
                );
  
            )[BusinessObject_id=$params.id];

            $count_app_data_obj := $count($query);
          
            $distinct(BusinessObjects.$spread().(
            
              $Object_id := $keys()[0];
              
              $.*.{
                "id": $Object_id,
                "title": title,
                "description": description,
                "type": type,
                "state": state,
                "state_update_date": state_update_date,
                "owner": owner,
                "division_owner": division_owner,
                "division_owner_link": "/architect/components/" & division_owner,
                "division_owner_title": $lookup($MANIFEST.components, division_owner).title,
                "count_app_data_obj": $count_app_data_obj
              };
              
              ))[id=$params.id]
          
          )